<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>devadevz | Cloud System</title>
    <style>
        :root { --blood: #8b0000; --bright: #ff0000; --bg: #050505; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: #fff; min-height: 100vh; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle at center, #1a0000 0%, #000 100%); overflow-x: hidden; }
        .main-card { background: rgba(20,20,20,0.9); padding: 3rem; border-radius: 15px; border: 1px solid rgba(139,0,0,0.3); width: 100%; max-width: 500px; text-align: center; backdrop-filter: blur(15px); animation: fadeIn 1s ease; }
        h1 { font-size: 3rem; letter-spacing: 10px; color: var(--blood); text-transform: uppercase; margin-bottom: 20px; text-shadow: 0 0 15px var(--blood); }
        input { width: 100%; padding: 15px; background: #111; border: 1px solid #333; border-radius: 5px; color: #fff; margin-top: 15px; text-align: center; transition: 0.3s; }
        input:focus { border-color: var(--bright); outline: none; box-shadow: 0 0 10px var(--bright); }
        button { width: 100%; padding: 15px; margin-top: 15px; background: var(--blood); border: none; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; text-transform: uppercase; border-radius: 5px; }
        button:hover { background: var(--bright); box-shadow: 0 0 20px var(--bright); transform: translateY(-2px); }
        #panel { display: none; width: 95%; max-width: 1100px; background: rgba(10,10,10,0.95); padding: 2rem; border-radius: 10px; border: 1px solid #300; animation: slideUp 0.8s ease; }
        .grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; margin-top: 20px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .box { background: rgba(0,0,0,0.5); padding: 1.5rem; border-radius: 10px; border: 1px solid #222; }
        .file { background: #111; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--blood); transition: 0.3s; }
        .file:hover { background: #1a1a1a; }
        table { width: 100%; font-size: 12px; margin-top: 10px; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #222; }
        th { color: var(--bright); text-transform: uppercase; }
        .ban-btn { background: #ff0000; padding: 5px 10px; font-size: 10px; width: auto; margin: 0; border-radius: 3px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

<div id="login-screen" class="main-card">
    <h1>devadevz</h1>
    <p style="color: #666; font-size: 0.8rem; letter-spacing: 3px;">Developer quantumpeakk
Owner devadevz</p>
    <input type="password" id="key-input" placeholder="ACCESS KEY">
    <button onclick="login()">Sisteme Giriş</button>
</div>

<div id="panel">
    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #300; padding-bottom:10px;">
        <h2 id="title" style="color: var(--bright); letter-spacing: 3px;">CORE_PANEL</h2>
        <button onclick="location.reload()" style="width:auto; padding:8px 20px; margin:0; background: #333;">Çıkış Yap</button>
    </div>
    <div class="grid">
        <div class="box">
            <h3 style="margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 5px;">Dosya Merkezi</h3>
            <div id="admin-add" style="display:none; margin-bottom:20px; padding: 15px; border: 1px dashed #444;">
                <input type="text" id="f-name" placeholder="Dosya Görünür Adı">
                <input type="text" id="f-url" placeholder="İndirme Linki (URL)">
                <button onclick="addFile()">Veritabanına Kaydet</button>
            </div>
            <div id="file-list"></div>
        </div>
        <div id="admin-logs" class="box" style="display:none;">
            <h3 style="margin-bottom: 15px; color: var(--bright);">Giriş Logları & IP Ban</h3>
            <table>
                <thead><tr><th>IP ADRESİ</th><th>ZAMAN</th><th>EYLEM</th></tr></thead>
                <tbody id="log-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script type="module">
    import { neon } from 'https://cdn.jsdelivr.net/npm/@neondatabase/serverless@0.6.0/+esm';
    
    // Veritabanı bağlantısı senin bilgilerinle güncellendi
    const sql = neon('postgresql://neondb_owner:npg_fjoS9H1imRcy@ep-curly-sunset-a4mief5x-pooler.us-east-1.aws.neon.tech/neondb?sslmode=require');

    let myIP = "";
    let userRole = "";

    // Gerçek IP çekme ve Ban kontrolü
    fetch('https://api.ipify.org?format=json')
        .then(r => r.json())
        .then(async d => { 
            myIP = d.ip; 
            const bans = await sql`SELECT * FROM bans WHERE ip = ${myIP}`;
            if(bans.length > 0) {
                document.body.innerHTML = "<h1 style='color:red; text-align:center; padding-top:20%'>ERİŞİM ENGELLENDİ<br>IP ADRESİNİZ YASAKLI: "+myIP+"</h1>";
            }
        });

    window.login = async function() {
        const key = document.getElementById('key-input').value;
        if(key === "devadevz777admin505" || key === "peak404") {
            userRole = key === "devadevz777admin505" ? "ADMIN" : "USER";
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('panel').style.display = 'block';
            document.getElementById('title').innerText = "devadevz | " + userRole;
            
            // Log kaydı
            await sql`INSERT INTO logs (ip, role, time) VALUES (${myIP}, ${userRole}, NOW())`;
            
            if(userRole === "ADMIN") {
                document.getElementById('admin-add').style.display = 'block';
                document.getElementById('admin-logs').style.display = 'block';
                loadLogs();
            }
            loadFiles();
        } else { 
            alert("GEÇERSİZ KEY!"); 
        }
    }

    async function loadFiles() {
        const files = await sql`SELECT * FROM posts ORDER BY id DESC`;
        const list = document.getElementById('file-list');
        list.innerHTML = files.length === 0 ? "<p style='color:#444'>Dosya bulunamadı.</p>" : "";
        files.forEach(f => {
            list.innerHTML += `<div class="file">
                <span>${f.name}</span>
                <div>
                    ${userRole === "ADMIN" ? `<button onclick="deleteFile(${f.id})" class="ban-btn" style="margin-right:10px;">SİL</button>` : ''}
                    <a href="${f.url}" target="_blank" style="color:var(--bright); text-decoration:none; font-weight:bold;">[İNDİR]</a>
                </div>
            </div>`;
        });
    }

    window.addFile = async function() {
        const n = document.getElementById('f-name').value;
        const u = document.getElementById('f-url').value;
        if(!n || !u) return alert("Boş alan bırakma!");
        await sql`INSERT INTO posts (name, url) VALUES (${n}, ${u})`;
        document.getElementById('f-name').value = "";
        document.getElementById('f-url').value = "";
        loadFiles();
    }

    window.deleteFile = async function(id) {
        if(confirm("Silmek istediğine emin misin?")) {
            await sql`DELETE FROM posts WHERE id = ${id}`;
            loadFiles();
        }
    }

    async function loadLogs() {
        const logs = await sql`SELECT * FROM logs ORDER BY id DESC LIMIT 50`;
        const body = document.getElementById('log-body');
        body.innerHTML = "";
        logs.forEach(l => {
            body.innerHTML += `<tr>
                <td>${l.ip} <br><small style="color:#555">${l.role}</small></td>
                <td>${new Date(l.time).toLocaleTimeString()}</td>
                <td><button onclick="banIP('${l.ip}')" class="ban-btn">BANLA</button></td>
            </tr>`;
        });
    }

    window.banIP = async function(ip) {
        if(confirm(ip + " adresini banlamak istiyor musun?")) {
            await sql`INSERT INTO bans (ip) VALUES (${ip})`;
            alert("Yasaklandı!");
            loadLogs();
        }
    }
</script>
</body>
</html>
